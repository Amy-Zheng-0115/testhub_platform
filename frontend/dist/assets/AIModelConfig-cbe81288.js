import{_ as x,C as w,e as c,o as u,c as m,b as e,A as _,F as E,y as T,B as F,N as p,am as S,t as r,f,O as h,ab as q,P as I,aa as R,G as M,z as U}from"./index-b9247cb2.js";const V={name:"AIModelConfig",data(){return{configs:[],showAddModal:!1,showEditModal:!1,showTestResult:!1,isEditing:!1,isSaving:!1,isTestingConnection:!1,testingConfigId:null,editingConfigId:null,configForm:{name:"",model_type:"",role:"",api_key:"",base_url:"",model_name:"",max_tokens:4096,temperature:.7,top_p:.9,is_active:!0},testResult:{success:!1,message:"",response:""}}},computed:{shouldShowModal(){const l=this.showAddModal||this.showEditModal;return console.log("Computed shouldShowModal:",l,{showAddModal:this.showAddModal,showEditModal:this.showEditModal}),l}},watch:{configForm:{handler(l,s){console.log("ConfigForm changed:",JSON.stringify(l))},deep:!0},shouldShowModal(l,s){console.log("Modal visibility changed:",l,"was:",s)}},mounted(){console.log("AIModelConfig component mounted"),console.log("Initial showAddModal state:",this.showAddModal),console.log("Initial showEditModal state:",this.showEditModal),console.log("Initial configForm:",JSON.stringify(this.configForm)),this.initializeComponent(),this.loadConfigs()},methods:{initializeComponent(){this.showAddModal=!1,this.showEditModal=!1,this.showTestResult=!1,this.isEditing=!1,this.isSaving=!1,this.isTestingConnection=!1,this.testingConfigId=null,this.editingConfigId=null,console.log("Component initialized with states:",{showAddModal:this.showAddModal,showEditModal:this.showEditModal,isEditing:this.isEditing})},async loadConfigs(){var l,s,a;try{console.log("Loading configs...");const i=await w.get("/requirement-analysis/api/ai-models/");console.log("API response:",i.data),i.data&&i.data.results&&Array.isArray(i.data.results)?(this.configs=i.data.results.filter(t=>t&&t.id),console.log("Loaded configs from results:",this.configs)):i.data&&Array.isArray(i.data)?(this.configs=i.data.filter(t=>t&&t.id),console.log("Loaded configs from direct array:",this.configs)):(console.warn("Unexpected API response format:",i.data),this.configs=[]),console.log("Final configs count:",this.configs.length)}catch(i){console.error("åŠ è½½é…ç½®å¤±è´¥:",i),this.configs=[],((l=i.response)==null?void 0:l.status)===401?c.error("è¯·å…ˆç™»å½•"):c.error("åŠ è½½é…ç½®å¤±è´¥: "+(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.error)||i.message))}},openAddModal(){console.log("Opening add modal - button clicked");try{this.resetForm(),this.isEditing=!1,this.showAddModal=!0,console.log("Modal state set to true:",this.showAddModal),console.log("Initial form after reset:",JSON.stringify(this.configForm)),this.$nextTick(()=>{console.log("Modal should be visible now:",this.showAddModal),console.log("Form in nextTick:",JSON.stringify(this.configForm))})}catch(l){console.error("Error in openAddModal:",l)}},resetForm(){Object.assign(this.configForm,{name:"",model_type:"",role:"",api_key:"",base_url:"",model_name:"",max_tokens:4096,temperature:.7,top_p:.9,is_active:!0}),console.log("Form reset:",JSON.stringify(this.configForm))},editConfig(l){this.isEditing=!0,this.editingConfigId=l.id,this.configForm={name:l.name,model_type:l.model_type,role:l.role,api_key:l.api_key_masked||"",base_url:l.base_url,model_name:l.model_name,max_tokens:l.max_tokens,temperature:l.temperature,top_p:l.top_p,is_active:l.is_active},this.showEditModal=!0},async saveConfig(){var a,i,t,n,o,y,k,C;console.log("Saving config with data:",this.configForm),console.log("Field values:"),console.log("- name:",this.configForm.name,"length:",(a=this.configForm.name)==null?void 0:a.length),console.log("- model_type:",this.configForm.model_type,"length:",(i=this.configForm.model_type)==null?void 0:i.length),console.log("- role:",this.configForm.role,"length:",(t=this.configForm.role)==null?void 0:t.length),console.log("- api_key:",this.configForm.api_key,"length:",(n=this.configForm.api_key)==null?void 0:n.length),console.log("- base_url:",this.configForm.base_url,"length:",(o=this.configForm.base_url)==null?void 0:o.length),console.log("- model_name:",this.configForm.model_name,"length:",(y=this.configForm.model_name)==null?void 0:y.length);const s=[{name:"name",value:this.configForm.name},{name:"model_type",value:this.configForm.model_type},{name:"role",value:this.configForm.role},{name:"api_key",value:this.configForm.api_key},{name:"base_url",value:this.configForm.base_url},{name:"model_name",value:this.configForm.model_name}].filter(d=>!d.value||d.value.trim()==="");if(s.length>0){console.log("Empty fields:",s),c.error(`è¯·å¡«å†™ä»¥ä¸‹å¿…å¡«å­—æ®µ: ${s.map(d=>d.name).join(", ")}`);return}if(!this.isEditing&&this.configForm.is_active){const d=this.configs.find(g=>g.model_type===this.configForm.model_type&&g.role===this.configForm.role&&g.is_active===!0);if(d){c.error(`å·²å­˜åœ¨ç›¸åŒçš„æ´»è·ƒé…ç½®ï¼š${d.name}ã€‚è¯·é€‰æ‹©ä¸åŒçš„æ¨¡å‹ç±»å‹æˆ–è§’è‰²ï¼Œæˆ–å…ˆç¦ç”¨ç°æœ‰é…ç½®ã€‚`);return}}this.isSaving=!0;try{if(this.isEditing){const d={...this.configForm};(!d.api_key||d.api_key.includes("*"))&&delete d.api_key,console.log("Updating with data:",d),await w.patch(`/requirement-analysis/api/ai-models/${this.editingConfigId}/`,d),c.success("é…ç½®æ›´æ–°æˆåŠŸ")}else console.log("Creating with data:",this.configForm),await w.post("/requirement-analysis/api/ai-models/",this.configForm),c.success("é…ç½®æ·»åŠ æˆåŠŸ");this.closeModals(),await this.$nextTick(),await this.loadConfigs(),this.$forceUpdate(),console.log("Config saved and list refreshed, total configs:",this.configs.length)}catch(d){if(console.error("ä¿å­˜é…ç½®å¤±è´¥:",d),console.error("Error response:",(k=d.response)==null?void 0:k.data),(C=d.response)!=null&&C.data){const g=d.response.data;let b="ä¿å­˜å¤±è´¥: ";g.non_field_errors?g.non_field_errors.find(A=>A.includes("å”¯ä¸€é›†åˆ")||A.includes("unique"))?b="é…ç½®å†²çªï¼šå·²å­˜åœ¨ç›¸åŒçš„æ¨¡å‹ç±»å‹å’Œè§’è‰²ç»„åˆçš„æ´»è·ƒé…ç½®ã€‚è¯·é€‰æ‹©ä¸åŒçš„æ¨¡å‹ç±»å‹æˆ–è§’è‰²ï¼Œæˆ–å…ˆç¦ç”¨ç°æœ‰é…ç½®ã€‚":b+=g.non_field_errors.join(", "):Object.keys(g).forEach(v=>{Array.isArray(g[v])?b+=`${v}: ${g[v].join(", ")}; `:b+=`${v}: ${g[v]}; `}),c.error(b)}else c.error("ä¿å­˜å¤±è´¥: "+d.message)}finally{this.isSaving=!1}},async deleteConfig(l){var s,a;if(confirm("ç¡®å®šè¦åˆ é™¤æ­¤é…ç½®å—ï¼Ÿ"))try{await w.delete(`/requirement-analysis/api/ai-models/${l}/`),c.success("é…ç½®åˆ é™¤æˆåŠŸ"),this.loadConfigs()}catch(i){console.error("åˆ é™¤é…ç½®å¤±è´¥:",i),c.error("åˆ é™¤å¤±è´¥: "+(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.error)||i.message))}},async testConnection(l){var s,a;this.isTestingConnection=!0,this.testingConfigId=l.id;try{const i=await w.post(`/requirement-analysis/api/ai-models/${l.id}/test_connection/`);this.testResult=i.data,this.showTestResult=!0}catch(i){console.error("æµ‹è¯•è¿æ¥å¤±è´¥:",i),this.testResult={success:!1,message:((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.message)||i.message,response:""},this.showTestResult=!0}finally{this.isTestingConnection=!1,this.testingConfigId=null}},closeModals(){console.log("Closing modals - current states:",{showAddModal:this.showAddModal,showEditModal:this.showEditModal,isEditing:this.isEditing}),this.showAddModal=!1,this.showEditModal=!1,this.isEditing=!1,this.editingConfigId=null,this.resetForm(),this.$nextTick(()=>{console.log("After nextTick - states:",{showAddModal:this.showAddModal,showEditModal:this.showEditModal,shouldShow:this.shouldShowModal}),this.$forceUpdate()}),console.log("After closing - states:",{showAddModal:this.showAddModal,showEditModal:this.showEditModal,isEditing:this.isEditing})},closeTestResult(){this.showTestResult=!1},formatDateTime(l){return l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}}},N={class:"ai-model-config"},P={class:"main-content"},O={class:"configs-section"},D={class:"section-header"},L={class:"configs-grid"},z={key:0,class:"config-card"},B={class:"config-header"},K={class:"config-title"},j={class:"config-badges"},J={class:"config-actions"},G=["onClick","disabled"],H={key:0},Q={key:1},W=["onClick"],X=["onClick"],Y={class:"config-details"},Z={class:"detail-item"},$={class:"detail-item"},ss={class:"detail-item"},es={class:"detail-item"},os={class:"detail-item"},ts={key:0,class:"empty-state"},ls={class:"modal-header"},is={class:"modal-body"},ns={class:"form-group"},ds={class:"form-group"},rs={class:"form-group"},as={class:"form-group"},us=["placeholder","required"],ms={key:0,class:"form-hint"},gs={class:"form-group"},ps={class:"form-group"},cs={class:"form-row"},fs={class:"form-group"},hs={class:"form-group"},vs={class:"form-group"},_s={class:"form-group"},ys={class:"checkbox-label"},bs={class:"modal-actions"},ws=["disabled"],Fs={key:0},Ms={key:1},ks={class:"modal-header"},Cs={class:"modal-body"},As={class:"result-icon"},Es={class:"result-content"},Is={key:0,class:"api-response"};function xs(l,s,a,i,t,n){return u(),m("div",N,[s[50]||(s[50]=e("div",{class:"page-header"},[e("h1",null,"ğŸ¤– AIæ¨¡å‹é…ç½®"),e("p",null,"é…ç½®ç”¨äºæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå’Œè¯„å®¡çš„AIæ¨¡å‹")],-1)),e("div",P,[e("div",O,[e("div",D,[s[25]||(s[25]=e("h2",null,"æ¨¡å‹é…ç½®åˆ—è¡¨",-1)),e("button",{class:"add-config-btn",onClick:s[0]||(s[0]=_((...o)=>n.openAddModal&&n.openAddModal(...o),["stop"])),type:"button"}," â• æ·»åŠ é…ç½® ")]),e("div",L,[(u(!0),m(E,null,T(t.configs,o=>(u(),m(E,{key:(o==null?void 0:o.id)||"unknown"},[o&&o.id?(u(),m("div",z,[e("div",B,[e("div",K,[e("h3",null,r(o.name||"æœªå‘½åé…ç½®"),1),e("div",j,[e("span",{class:M(["model-badge",o.model_type])},r(o.model_type_display||o.model_type),3),e("span",{class:M(["role-badge",o.role])},r(o.role_display||o.role),3),e("span",{class:M(["status-badge",{active:o.is_active}])},r(o.is_active?"å¯ç”¨":"ç¦ç”¨"),3)])]),e("div",J,[e("button",{class:"test-btn",onClick:y=>n.testConnection(o),disabled:t.isTestingConnection},[t.isTestingConnection&&t.testingConfigId===o.id?(u(),m("span",H,"ğŸ”„")):(u(),m("span",Q,"ğŸ”—")),s[26]||(s[26]=f(" æµ‹è¯•è¿æ¥ ",-1))],8,G),e("button",{class:"edit-btn",onClick:y=>n.editConfig(o)},"âœï¸",8,W),e("button",{class:"delete-btn",onClick:y=>n.deleteConfig(o.id)},"ğŸ—‘ï¸",8,X)])]),e("div",Y,[e("div",Z,[s[27]||(s[27]=e("label",null,"API Base URL:",-1)),e("span",null,r(o.base_url),1)]),e("div",$,[s[28]||(s[28]=e("label",null,"æ¨¡å‹åç§°:",-1)),e("span",null,r(o.model_name),1)]),e("div",ss,[s[29]||(s[29]=e("label",null,"æœ€å¤§Tokenæ•°:",-1)),e("span",null,r(o.max_tokens),1)]),e("div",es,[s[30]||(s[30]=e("label",null,"æ¸©åº¦å‚æ•°:",-1)),e("span",null,r(o.temperature),1)]),e("div",os,[s[31]||(s[31]=e("label",null,"åˆ›å»ºæ—¶é—´:",-1)),e("span",null,r(n.formatDateTime(o.created_at)),1)])])])):F("",!0)],64))),128))]),t.configs.length===0?(u(),m("div",ts,[s[32]||(s[32]=e("div",{class:"empty-icon"},"ğŸ¤–",-1)),s[33]||(s[33]=e("h3",null,"æš‚æ— AIæ¨¡å‹é…ç½®",-1)),s[34]||(s[34]=e("p",null,"è¯·æ·»åŠ æ‚¨çš„AIæ¨¡å‹é…ç½®ä»¥å¼€å§‹ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ç”ŸæˆåŠŸèƒ½",-1)),e("button",{class:"add-first-config-btn",onClick:s[1]||(s[1]=_((...o)=>n.openAddModal&&n.openAddModal(...o),["stop"])),type:"button"}," â• æ·»åŠ ç¬¬ä¸€ä¸ªé…ç½® ")])):F("",!0)])]),p(e("div",{class:M(["config-modal",{hidden:!n.shouldShowModal}]),onClick:s[20]||(s[20]=(...o)=>n.closeModals&&n.closeModals(...o)),onKeydown:s[21]||(s[21]=U((...o)=>n.closeModals&&n.closeModals(...o),["esc"]))},[e("div",{class:"modal-content",onClick:s[19]||(s[19]=_(()=>{},["stop"]))},[e("div",ls,[e("h3",null,r(t.isEditing?"ç¼–è¾‘":"æ·»åŠ ")+"AIæ¨¡å‹é…ç½®",1),e("button",{class:"close-btn",onClick:s[2]||(s[2]=_((...o)=>n.closeModals&&n.closeModals(...o),["stop"])),type:"button"},"Ã—")]),e("div",is,[e("form",{onSubmit:s[18]||(s[18]=_((...o)=>n.saveConfig&&n.saveConfig(...o),["prevent"]))},[e("div",ns,[s[35]||(s[35]=e("label",null,[f("é…ç½®åç§° "),e("span",{class:"required"},"*")],-1)),p(e("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>t.configForm.name=o),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šDeepSeekæµ‹è¯•ç”¨ä¾‹ç¼–å†™",required:"",onInput:s[4]||(s[4]=o=>console.log("Name input:",o.target.value,"Form value:",t.configForm.name))},null,544),[[h,t.configForm.name]])]),e("div",ds,[s[37]||(s[37]=e("label",null,[f("æ¨¡å‹ç±»å‹ "),e("span",{class:"required"},"*")],-1)),p(e("select",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.configForm.model_type=o),class:"form-select",required:"",onChange:s[6]||(s[6]=o=>console.log("Model type changed to:",t.configForm.model_type))},s[36]||(s[36]=[q('<option value="" data-v-df8b7576>è¯·é€‰æ‹©æ¨¡å‹ç±»å‹</option><option value="deepseek" data-v-df8b7576>DeepSeek</option><option value="qwen" data-v-df8b7576>é€šä¹‰åƒé—®</option><option value="siliconflow" data-v-df8b7576>ç¡…åŸºæµåŠ¨</option><option value="other" data-v-df8b7576>å…¶ä»–</option>',5)]),544),[[I,t.configForm.model_type]])]),e("div",rs,[s[39]||(s[39]=e("label",null,[f("è§’è‰² "),e("span",{class:"required"},"*")],-1)),p(e("select",{"onUpdate:modelValue":s[7]||(s[7]=o=>t.configForm.role=o),class:"form-select",required:"",onChange:s[8]||(s[8]=o=>console.log("Role changed to:",t.configForm.role))},s[38]||(s[38]=[e("option",{value:""},"è¯·é€‰æ‹©è§’è‰²",-1),e("option",{value:"writer"},"æµ‹è¯•ç”¨ä¾‹ç¼–å†™ä¸“å®¶",-1),e("option",{value:"reviewer"},"æµ‹è¯•è¯„å®¡ä¸“å®¶",-1)]),544),[[I,t.configForm.role]])]),e("div",as,[s[40]||(s[40]=e("label",null,[f("API Key "),e("span",{class:"required"},"*")],-1)),p(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>t.configForm.api_key=o),type:"password",class:"form-input",placeholder:t.isEditing?"ä¸ä¿®æ”¹è¯·ä¿æŒåŸå€¼ä¸å˜ï¼Œå¡«å†™æ–°å€¼åˆ™æ›´æ–°":"è¾“å…¥æ‚¨çš„API Key",required:!t.isEditing,onInput:s[10]||(s[10]=o=>console.log("API Key input:",o.target.value,"Form value:",t.configForm.api_key))},null,40,us),[[h,t.configForm.api_key]]),t.isEditing&&t.configForm.api_key&&t.configForm.api_key.includes("*")?(u(),m("small",ms," å½“å‰æ˜¾ç¤ºçš„æ˜¯æ©ç æ ¼å¼ï¼Œå¦‚éœ€ä¿®æ”¹è¯·è¾“å…¥æ–°çš„API Key ")):F("",!0)]),e("div",gs,[s[41]||(s[41]=e("label",null,[f("API Base URL "),e("span",{class:"required"},"*")],-1)),p(e("input",{"onUpdate:modelValue":s[11]||(s[11]=o=>t.configForm.base_url=o),type:"url",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šhttps://api.deepseek.com/v1",required:""},null,512),[[h,t.configForm.base_url]])]),e("div",ps,[s[42]||(s[42]=e("label",null,[f("æ¨¡å‹åç§° "),e("span",{class:"required"},"*")],-1)),p(e("input",{"onUpdate:modelValue":s[12]||(s[12]=o=>t.configForm.model_name=o),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šdeepseek-chat",required:""},null,512),[[h,t.configForm.model_name]])]),e("div",cs,[e("div",fs,[s[43]||(s[43]=e("label",null,"æœ€å¤§Tokenæ•°",-1)),p(e("input",{"onUpdate:modelValue":s[13]||(s[13]=o=>t.configForm.max_tokens=o),type:"number",min:"100",max:"32000",class:"form-input",placeholder:"4096"},null,512),[[h,t.configForm.max_tokens,void 0,{number:!0}]])]),e("div",hs,[s[44]||(s[44]=e("label",null,"æ¸©åº¦å‚æ•°",-1)),p(e("input",{"onUpdate:modelValue":s[14]||(s[14]=o=>t.configForm.temperature=o),type:"number",min:"0",max:"2",step:"0.1",class:"form-input",placeholder:"0.7"},null,512),[[h,t.configForm.temperature,void 0,{number:!0}]])]),e("div",vs,[s[45]||(s[45]=e("label",null,"Top På‚æ•°",-1)),p(e("input",{"onUpdate:modelValue":s[15]||(s[15]=o=>t.configForm.top_p=o),type:"number",min:"0",max:"1",step:"0.1",class:"form-input",placeholder:"0.9"},null,512),[[h,t.configForm.top_p,void 0,{number:!0}]])])]),e("div",_s,[e("label",ys,[p(e("input",{"onUpdate:modelValue":s[16]||(s[16]=o=>t.configForm.is_active=o),type:"checkbox"},null,512),[[R,t.configForm.is_active]]),s[46]||(s[46]=e("span",{class:"checkmark"},null,-1)),s[47]||(s[47]=f(" å¯ç”¨æ­¤é…ç½® ",-1))])]),e("div",bs,[e("button",{type:"button",class:"cancel-btn",onClick:s[17]||(s[17]=(...o)=>n.closeModals&&n.closeModals(...o))},"å–æ¶ˆ"),e("button",{type:"submit",class:"confirm-btn",disabled:t.isSaving},[t.isSaving?(u(),m("span",Fs,"ğŸ”„ ä¿å­˜ä¸­...")):(u(),m("span",Ms,"ğŸ’¾ ä¿å­˜é…ç½®"))],8,ws)])],32)])])],34),[[S,n.shouldShowModal]]),t.showTestResult?(u(),m("div",{key:0,class:"test-result-modal",onClick:s[24]||(s[24]=(...o)=>n.closeTestResult&&n.closeTestResult(...o))},[e("div",{class:"modal-content",onClick:s[23]||(s[23]=_(()=>{},["stop"]))},[e("div",ks,[s[48]||(s[48]=e("h3",null,"è¿æ¥æµ‹è¯•ç»“æœ",-1)),e("button",{class:"close-btn",onClick:s[22]||(s[22]=(...o)=>n.closeTestResult&&n.closeTestResult(...o))},"Ã—")]),e("div",Cs,[e("div",{class:M(["test-result",{success:t.testResult.success,error:!t.testResult.success}])},[e("div",As,r(t.testResult.success?"âœ…":"âŒ"),1),e("div",Es,[e("h4",null,r(t.testResult.success?"è¿æ¥æˆåŠŸ":"è¿æ¥å¤±è´¥"),1),e("p",null,r(t.testResult.message),1),t.testResult.response?(u(),m("div",Is,[s[49]||(s[49]=e("label",null,"AIå›å¤:",-1)),e("p",null,r(t.testResult.response),1)])):F("",!0)])],2)])])])):F("",!0)])}const Ss=x(V,[["render",xs],["__scopeId","data-v-df8b7576"]]);export{Ss as default};
