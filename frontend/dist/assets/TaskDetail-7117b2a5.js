import{_ as x,C as b,e as u,r as S,o as h,c as g,b as s,t as d,G as C,B as f,d as w,w as D,f as y,ab as I,F as P,y as T,N as m,P as E,A,aa as z}from"./index-b9247cb2.js";import{u as k,w as M}from"./xlsx-f5126985.js";const N={name:"TaskDetail",data(){return{taskId:"",task:{},testCases:[],selectedCases:[],isLoading:!0,showCaseDetail:!1,selectedCase:{},selectedCaseIndex:0,currentPage:1,pageSize:10,isExporting:!1}},computed:{isAllSelected(){return this.testCases.length>0&&this.selectedCases.length===this.testCases.length},totalPages(){return Math.ceil(this.testCases.length/this.pageSize)},paginatedTestCases(){const a=(this.currentPage-1)*this.pageSize,e=a+this.pageSize;return this.testCases.slice(a,e)},paginationStart(){return(this.currentPage-1)*this.pageSize+1},paginationEnd(){return Math.min(this.currentPage*this.pageSize,this.testCases.length)}},mounted(){this.taskId=this.$route.params.taskId,this.loadTaskDetail()},methods:{async loadTaskDetail(){try{const a=await b.get(`/requirement-analysis/api/testcase-generation/${this.taskId}/`);this.task=a.data,this.task.final_test_cases&&(this.testCases=this.parseTestCases(this.task.final_test_cases))}catch(a){console.error("åŠ è½½ä»»åŠ¡è¯¦æƒ…å¤±è´¥:",a),u.error("åŠ è½½ä»»åŠ¡è¯¦æƒ…å¤±è´¥")}finally{this.isLoading=!1}},parseTestCases(a){if(!a)return[];const e=a.split(`
`).filter(i=>i.trim()),o=[];let n=!1;const t=[];for(let i of e){const r=i.trim();if(r.includes("|")&&!r.includes("--------")){const c=r.split("|").map(l=>l.trim()).filter(l=>l);c.length>1&&(t.push(c),n=!0)}}if(n&&t.length>1){const i=t[0];for(let r=1;r<t.length;r++){const c=t[r],l={};i.forEach((p,v)=>{const _=c[v]||"";p.includes("ç¼–å·")||p.includes("ID")||p.includes("ç”¨ä¾‹ID")?l.caseId=_:p.includes("åœºæ™¯")||p.includes("æ ‡é¢˜")||p.includes("æµ‹è¯•ç›®æ ‡")?l.scenario=_:p.includes("å‰ç½®")?l.precondition=_:p.includes("æ­¥éª¤")||p.includes("æ“ä½œæ­¥éª¤")?l.steps=_:p.includes("é¢„æœŸ")||p.includes("ç»“æœ")?l.expected=_:p.includes("ä¼˜å…ˆçº§")&&(l.priority=_)}),(l.scenario||l.caseId)&&(!l.steps&&l.scenario&&(l.steps="å‚è€ƒæµ‹è¯•ç›®æ ‡æ‰§è¡Œç›¸åº”æ“ä½œ"),o.push(l))}}else{let i={},r=1;for(const c of e)c.includes("æµ‹è¯•ç”¨ä¾‹")||c.includes("Test Case")||c.match(/^(\d+\.|\*|\-|\d+ã€)/)?(Object.keys(i).length>0&&(o.push(i),r++),i={caseId:`TC${String(r).padStart(3,"0")}`,scenario:c.replace(/^(\d+\.|\*|\-|\d+ã€)\s*/,"").replace(/æµ‹è¯•ç”¨ä¾‹\d*[:ï¼š]?\s*/,""),precondition:"",steps:"",expected:"",priority:"ä¸­"}):c.includes("å‰ç½®æ¡ä»¶")||c.includes("å‰æ")?i.precondition=c.replace(/.*?[:ï¼š]\s*/,""):c.includes("æµ‹è¯•æ­¥éª¤")||c.includes("æ“ä½œæ­¥éª¤")||c.includes("æ­¥éª¤")?i.steps=c.replace(/.*?[:ï¼š]\s*/,""):c.includes("é¢„æœŸç»“æœ")||c.includes("Expected")?i.expected=c.replace(/.*?[:ï¼š]\s*/,""):c.includes("ä¼˜å…ˆçº§")&&(i.priority=c.replace(/.*?[:ï¼š]\s*/,""));Object.keys(i).length>0&&o.push(i)}return o},getStatusText(a){return{pending:"éœ€æ±‚åˆ†æä¸­",generating:"ç”¨ä¾‹ç¼–å†™ä¸­",reviewing:"ç”¨ä¾‹è¯„å®¡ä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[a]||a},toggleSelectAll(){this.isAllSelected?this.selectedCases=[]:this.selectedCases=[...this.testCases]},updateSelectAll(){},async batchAdopt(){var a,e;if(this.selectedCases.length===0){u.warning("è¯·å…ˆé€‰æ‹©è¦é‡‡çº³çš„æµ‹è¯•ç”¨ä¾‹");return}if(confirm(`ç¡®å®šè¦é‡‡çº³é€‰ä¸­çš„ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹å—ï¼Ÿ`))try{const o=this.selectedCases.map((n,t)=>({title:n.scenario||`æµ‹è¯•ç”¨ä¾‹${t+1}`,description:n.scenario||"",preconditions:n.precondition||"",steps:n.steps||"",expected_result:n.expected||"",priority:this.mapPriority(n.priority),test_type:"functional",status:"draft"}));await b.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/batch_adopt_selected/`,{test_cases:o}),u.success(`æˆåŠŸé‡‡çº³ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹ï¼`),this.selectedCases=[]}catch(o){console.error("æ‰¹é‡é‡‡çº³å¤±è´¥:",o),u.error("æ‰¹é‡é‡‡çº³å¤±è´¥: "+(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||o.message))}},async batchDiscard(){var a,e;if(this.selectedCases.length===0){u.warning("è¯·å…ˆé€‰æ‹©è¦å¼ƒç”¨çš„æµ‹è¯•ç”¨ä¾‹");return}if(confirm(`ç¡®å®šè¦å¼ƒç”¨é€‰ä¸­çš„ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`))try{const o=this.selectedCases.map(t=>this.testCases.findIndex(r=>r.scenario===t.scenario&&r.steps===t.steps&&r.expected===t.expected)).filter(t=>t!==-1),n=await b.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/discard_selected_cases/`,{case_indices:o});n.data.task_deleted?(u.success("æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨ï¼Œä»»åŠ¡å·²åˆ é™¤"),this.$router.push("/generated-testcases")):(u.success(`æˆåŠŸå¼ƒç”¨ ${n.data.discarded_count} æ¡æµ‹è¯•ç”¨ä¾‹`),n.data.updated_test_cases&&(this.testCases=this.parseTestCases(n.data.updated_test_cases),this.selectedCases=[],this.currentPage=1))}catch(o){console.error("æ‰¹é‡å¼ƒç”¨å¤±è´¥:",o),u.error("æ‰¹é‡å¼ƒç”¨å¤±è´¥: "+(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.error)||o.message))}},viewCaseDetail(a,e){this.selectedCase=a,this.selectedCaseIndex=e,this.showCaseDetail=!0},closeCaseDetail(){this.showCaseDetail=!1,this.selectedCase={}},async adoptSingleCase(a,e){var o,n;if(confirm(`ç¡®å®šè¦é‡‡çº³æµ‹è¯•ç”¨ä¾‹"${a.scenario}"å—ï¼Ÿ`))try{const t={title:a.scenario||`æµ‹è¯•ç”¨ä¾‹${e+1}`,description:a.scenario||"",preconditions:a.precondition||"",steps:a.steps||"",expected_result:a.expected||"",priority:this.mapPriority(a.priority),test_type:"functional",status:"draft"};await b.post("/testcases/",t),u.success("æµ‹è¯•ç”¨ä¾‹é‡‡çº³æˆåŠŸï¼")}catch(t){console.error("é‡‡çº³ç”¨ä¾‹å¤±è´¥:",t),u.error("é‡‡çº³ç”¨ä¾‹å¤±è´¥: "+(((n=(o=t.response)==null?void 0:o.data)==null?void 0:n.message)||t.message))}},discardSingleCase(a,e){if(confirm(`ç¡®å®šè¦å¼ƒç”¨æµ‹è¯•ç”¨ä¾‹"${a.scenario}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`))try{const o=(this.currentPage-1)*this.pageSize+e;b.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/discard_single_case/`,{case_index:o}).then(n=>{n.data.task_deleted?(u.success("æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨ï¼Œä»»åŠ¡å·²åˆ é™¤"),this.$router.push("/generated-testcases")):(u.success("æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨"),n.data.updated_test_cases&&(this.testCases=this.parseTestCases(n.data.updated_test_cases),this.currentPage>1&&this.paginatedTestCases.length===0&&this.currentPage--))}).catch(n=>{var t,i;console.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥:",n),u.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥: "+(((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.error)||n.message))})}catch(o){console.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥:",o),u.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥")}},mapPriority(a){return{æœ€é«˜:"critical",é«˜:"high",ä¸­:"medium",ä½:"low",P0:"critical",P1:"high",P2:"medium",P3:"low"}[a]||"medium"},exportToExcel(){if(this.testCases.length===0){u.warning("æ²¡æœ‰æµ‹è¯•ç”¨ä¾‹å¯ä»¥å¯¼å‡º");return}this.isExporting=!0;try{const a=k.book_new(),e=[];e.push(["æµ‹è¯•ç”¨ä¾‹ç¼–å·","æµ‹è¯•åœºæ™¯","å‰ç½®æ¡ä»¶","æ“ä½œæ­¥éª¤","é¢„æœŸç»“æœ","ä¼˜å…ˆçº§"]),this.testCases.forEach((i,r)=>{e.push([i.caseId||`TC${String(r+1).padStart(3,"0")}`,i.scenario||"",i.precondition||"",i.steps||"",i.expected||"",i.priority||"ä¸­"])});const o=k.aoa_to_sheet(e),n=[{wch:15},{wch:30},{wch:25},{wch:40},{wch:30},{wch:10}];o["!cols"]=n,k.book_append_sheet(a,o,"æµ‹è¯•ç”¨ä¾‹");const t=`æµ‹è¯•ç”¨ä¾‹_${this.taskId}_${new Date().toISOString().slice(0,10)}.xlsx`;M(a,t),u.success("æµ‹è¯•ç”¨ä¾‹å¯¼å‡ºæˆåŠŸ")}catch(a){console.error("å¯¼å‡ºExcelå¤±è´¥:",a),u.error("å¯¼å‡ºExcelå¤±è´¥: "+(a.message||"æœªçŸ¥é”™è¯¯"))}finally{this.isExporting=!1}}}},L={class:"task-detail"},V={class:"page-header"},q={class:"header-left"},B={class:"task-info"},F={class:"task-id"},O={class:"header-actions"},j=["disabled"],U={key:0},G={key:1},R={key:0,class:"loading-state"},W={key:1,class:"error-state"},H={key:2,class:"task-content"},J={key:0,class:"batch-actions"},K={class:"selection-info"},Q={class:"select-all"},X=["checked"],Y={key:0,class:"selected-count"},Z={class:"batch-buttons"},$=["disabled"],ee=["disabled"],se={key:1,class:"testcases-table"},te={class:"table-body"},ie={class:"body-cell checkbox-cell"},le=["value"],ae={class:"body-cell"},ne={class:"body-cell"},oe={class:"body-cell"},ce={class:"body-cell"},de={class:"body-cell"},re={class:"body-cell"},pe={class:"body-cell"},ue={class:"action-buttons"},he=["onClick"],ge=["onClick"],_e=["onClick"],be={key:2,class:"empty-state"},fe={key:3,class:"pagination-section"},ve={class:"pagination-info"},Ce={class:"pagination-controls"},ke={class:"page-size-selector"},ye={class:"pagination-buttons"},me=["disabled"],xe={class:"current-page"},Se=["disabled"],we={class:"modal-header"},De={class:"modal-body"},Ie={class:"detail-item"},Pe={class:"detail-item"},Te={class:"detail-item"},Ee={class:"detail-item"},Ae={class:"test-steps"},ze={class:"detail-item"},Me={class:"detail-item"};function Ne(a,e,o,n,t,i){var c;const r=S("router-link");return h(),g("div",L,[s("div",V,[s("div",q,[s("h2",null,"ä»»åŠ¡è¯¦æƒ… - "+d(t.task.title),1),s("div",B,[s("span",F,"ä»»åŠ¡ID: "+d(t.taskId),1),s("span",{class:C(["task-status",t.task.status])},d(i.getStatusText(t.task.status)),3)])]),s("div",O,[t.testCases.length>0?(h(),g("button",{key:0,class:"export-btn",onClick:e[0]||(e[0]=(...l)=>i.exportToExcel&&i.exportToExcel(...l)),disabled:t.isExporting},[t.isExporting?(h(),g("span",U,"ğŸ’¾ å¯¼å‡ºä¸­...")):(h(),g("span",G,"ğŸ’¾ å¯¼å‡ºExcel"))],8,j)):f("",!0)])]),t.isLoading?(h(),g("div",R,e[13]||(e[13]=[s("p",null,"ğŸ”„ æ­£åœ¨åŠ è½½ä»»åŠ¡è¯¦æƒ…...",-1)]))):t.task.task_id?(h(),g("div",H,[t.testCases.length>0?(h(),g("div",J,[s("div",K,[s("label",Q,[s("input",{type:"checkbox",checked:i.isAllSelected,onChange:e[1]||(e[1]=(...l)=>i.toggleSelectAll&&i.toggleSelectAll(...l))},null,40,X),e[16]||(e[16]=y(" å…¨é€‰ ",-1))]),t.selectedCases.length>0?(h(),g("span",Y," å·²é€‰æ‹© "+d(t.selectedCases.length)+" æ¡ç”¨ä¾‹ ",1)):f("",!0)]),s("div",Z,[s("button",{class:"batch-adopt-btn",disabled:t.selectedCases.length===0,onClick:e[2]||(e[2]=(...l)=>i.batchAdopt&&i.batchAdopt(...l))}," âœ… ä¸€é”®é‡‡çº³ ("+d(t.selectedCases.length)+") ",9,$),s("button",{class:"batch-discard-btn",disabled:t.selectedCases.length===0,onClick:e[3]||(e[3]=(...l)=>i.batchDiscard&&i.batchDiscard(...l))}," âŒ ä¸€é”®å¼ƒç”¨ ("+d(t.selectedCases.length)+") ",9,ee)])])):f("",!0),t.testCases.length>0?(h(),g("div",se,[e[17]||(e[17]=I('<div class="table-header" data-v-ba67b17f><div class="header-cell checkbox-cell" data-v-ba67b17f>é€‰æ‹©</div><div class="header-cell" data-v-ba67b17f>æµ‹è¯•ç”¨ä¾‹ç¼–å·</div><div class="header-cell" data-v-ba67b17f>æµ‹è¯•åœºæ™¯</div><div class="header-cell" data-v-ba67b17f>å‰ç½®æ¡ä»¶</div><div class="header-cell" data-v-ba67b17f>æ“ä½œæ­¥éª¤</div><div class="header-cell" data-v-ba67b17f>é¢„æœŸç»“æœ</div><div class="header-cell" data-v-ba67b17f>ä¼˜å…ˆçº§</div><div class="header-cell" data-v-ba67b17f>æ“ä½œ</div></div>',1)),s("div",te,[(h(!0),g(P,null,T(i.paginatedTestCases,(l,p)=>{var v;return h(),g("div",{key:l.id||p,class:"table-row"},[s("div",ie,[m(s("input",{type:"checkbox",value:l,"onUpdate:modelValue":e[4]||(e[4]=_=>t.selectedCases=_),onChange:e[5]||(e[5]=(..._)=>i.updateSelectAll&&i.updateSelectAll(..._))},null,40,le),[[z,t.selectedCases]])]),s("div",ae,d(l.caseId||`TC${String(p+1).padStart(3,"0")}`),1),s("div",ne,d(l.scenario),1),s("div",oe,d(l.precondition),1),s("div",ce,d(l.steps),1),s("div",de,d(l.expected),1),s("div",re,[s("span",{class:C(["priority-tag",(v=l.priority)==null?void 0:v.toLowerCase()])},d(l.priority||"ä¸­"),3)]),s("div",pe,[s("div",ue,[s("button",{class:"view-btn",onClick:_=>i.viewCaseDetail(l,p)},"ğŸ“– æŸ¥çœ‹è¯¦æƒ…",8,he),s("button",{class:"adopt-btn",onClick:_=>i.adoptSingleCase(l,p)},"âœ… é‡‡çº³",8,ge),s("button",{class:"discard-btn",onClick:_=>i.discardSingleCase(l,p)},"âŒ å¼ƒç”¨",8,_e)])])])}),128))])])):(h(),g("div",be,e[18]||(e[18]=[s("h3",null,"æš‚æ— æµ‹è¯•ç”¨ä¾‹æ•°æ®",-1),s("p",null,"è¯¥ä»»åŠ¡è¿˜æ²¡æœ‰ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æˆ–ç”¨ä¾‹å·²è¢«æ¸…ç©º",-1)]))),t.testCases.length>0?(h(),g("div",fe,[s("div",ve," æ˜¾ç¤º "+d(i.paginationStart)+"-"+d(i.paginationEnd)+" æ¡ï¼Œå…± "+d(t.testCases.length)+" æ¡ ",1),s("div",Ce,[s("div",ke,[e[20]||(e[20]=s("label",null,"æ¯é¡µæ˜¾ç¤ºï¼š",-1)),m(s("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>t.pageSize=l),onChange:e[7]||(e[7]=l=>t.currentPage=1)},e[19]||(e[19]=[s("option",{value:"10"},"10 æ¡",-1),s("option",{value:"20"},"20 æ¡",-1),s("option",{value:"50"},"50 æ¡",-1)]),544),[[E,t.pageSize]])]),s("div",ye,[s("button",{disabled:t.currentPage<=1,onClick:e[8]||(e[8]=l=>t.currentPage--)},"ä¸Šä¸€é¡µ",8,me),s("span",xe,"ç¬¬ "+d(t.currentPage)+" é¡µï¼Œå…± "+d(i.totalPages)+" é¡µ",1),s("button",{disabled:t.currentPage>=i.totalPages,onClick:e[9]||(e[9]=l=>t.currentPage++)},"ä¸‹ä¸€é¡µ",8,Se)])])])):f("",!0)])):(h(),g("div",W,[e[15]||(e[15]=s("h3",null,"ä»»åŠ¡ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤",-1)),w(r,{to:"/generated-testcases"},{default:D(()=>e[14]||(e[14]=[y("è¿”å›ä»»åŠ¡åˆ—è¡¨",-1)])),_:1,__:[14]})])),t.showCaseDetail?(h(),g("div",{key:3,class:"case-detail-modal",onClick:e[12]||(e[12]=(...l)=>i.closeCaseDetail&&i.closeCaseDetail(...l))},[s("div",{class:"modal-content",onClick:e[11]||(e[11]=A(()=>{},["stop"]))},[s("div",we,[e[21]||(e[21]=s("h3",null,"æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…",-1)),s("button",{class:"close-btn",onClick:e[10]||(e[10]=(...l)=>i.closeCaseDetail&&i.closeCaseDetail(...l))},"Ã—")]),s("div",De,[s("div",Ie,[e[22]||(e[22]=s("label",null,"ç”¨ä¾‹ç¼–å·:",-1)),s("span",null,d(t.selectedCase.caseId||`TC${String(t.selectedCaseIndex+1).padStart(3,"0")}`),1)]),s("div",Pe,[e[23]||(e[23]=s("label",null,"æµ‹è¯•åœºæ™¯:",-1)),s("p",null,d(t.selectedCase.scenario),1)]),s("div",Te,[e[24]||(e[24]=s("label",null,"å‰ç½®æ¡ä»¶:",-1)),s("p",null,d(t.selectedCase.precondition),1)]),s("div",Ee,[e[25]||(e[25]=s("label",null,"æ“ä½œæ­¥éª¤:",-1)),s("p",Ae,d(t.selectedCase.steps),1)]),s("div",ze,[e[26]||(e[26]=s("label",null,"é¢„æœŸç»“æœ:",-1)),s("p",null,d(t.selectedCase.expected),1)]),s("div",Me,[e[27]||(e[27]=s("label",null,"ä¼˜å…ˆçº§:",-1)),s("span",{class:C(["priority-tag",(c=t.selectedCase.priority)==null?void 0:c.toLowerCase()])},d(t.selectedCase.priority||"ä¸­"),3)])])])])):f("",!0)])}const qe=x(N,[["render",Ne],["__scopeId","data-v-ba67b17f"]]);export{qe as default};
